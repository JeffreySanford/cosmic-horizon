<div class="jobs-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>CosmicAI TACC Orchestration</mat-card-title>
      <mat-card-subtitle>Phase 4 Remote Compute Gateway</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <form class="job-form">
        <mat-form-field appearance="fill">
          <mat-label>Agent</mat-label>
          <mat-select [(ngModel)]="selectedAgent" name="agent">
            @for (agent of agents; track agent) {
              <mat-option [value]="agent">{{agent}}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Dataset ID</mat-label>
          <input matInput [(ngModel)]="datasetId" name="datasetId">
        </mat-form-field>

        <div class="params-row">
          <mat-form-field appearance="fill">
            <mat-label>RFI Strategy</mat-label>
            <mat-select [(ngModel)]="rfiStrategy" name="rfi">
              <mat-option value="low">Low</mat-option>
              <mat-option value="medium">Medium</mat-option>
              <mat-option value="high">High</mat-option>
              <mat-option value="high_sensitivity">High Sensitivity</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>GPU Count</mat-label>
            <input matInput type="number" [(ngModel)]="gpuCount" name="gpus">
          </mat-form-field>
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions>
      <button mat-raised-button color="primary" (click)="submitJob()" [disabled]="isLoading">
        <mat-icon>launch</mat-icon>
        SUBMIT TO TACC
      </button>
    </mat-card-actions>
  </mat-card>

  @if (activeJobs.length > 0) {
    <div class="active-jobs">
      <h3>Active Job Queue</h3>
      @for (job of activeJobs; track job.id) {
        <mat-card class="job-item">
          <div class="job-header">
            <span class="job-id">{{job.id}}</span>
            <mat-chip-listbox>
              <mat-chip [color]="job.status === 'COMPLETED' ? 'accent' : 'primary'" selected>
                {{job.status}}
              </mat-chip>
            </mat-chip-listbox>
          </div>
          
          <mat-progress-bar mode="determinate" [value]="job.progress * 100"></mat-progress-bar>
          
          @if (job.output_url) {
            <div class="job-actions">
              <a mat-button [href]="job.output_url" target="_blank">
                <mat-icon>download</mat-icon>
                VIEW CALIBRATED DATA
              </a>
            </div>
          }
        </mat-card>
      }
    </div>
  }
</div>
